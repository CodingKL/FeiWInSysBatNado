
挺好用！Shell脚本日志技巧
		https://www.51cto.com/article/675859.html
------------------------------------------------------------------------------------------------------------

本文介绍了shell脚本中日志打印的一些技巧， 
     这些技巧都是从实践中总结出来的，
         文中提供了脚本的全部代码，
             可以拿来直接使用，
                 也可根据实际的需求自行调整。

------------------------------------------------------------------------------------------------------------

本文转载自微信公众号「Linux开发那些事儿」，作者LinuxThings。转载本文请联系Linux开发那些事儿公众号。
执行shell脚本时，常常会打印一些日志到控制台，根据输出的日志，来判断脚本功能正确与否

但是，太多日志打印的话，会让阅读变得很困难，从日志信息里面找到我们关心的那部分也变得很不方便了

所以，有一个好用的shell脚本日志接口是非常有必要的，本文将聊聊实践中日志打印的一些技巧

------------------------------------------------------------------------------------------------------------
常见日志打印方式
	编写 shell 脚本时，最简单的日志打印是使用 echo 输出，比如: 下面是打印一个测试程序的日志
			[root@VM-0-2-centos ~]# echo "this is a log test..." 
			this is a log test... 

	上面的方式使用起来非常简单，编写效率也很高，对于一些功能简单，代码量少的shell脚本，非常适合这种日志打印的方式，简单快捷

------------------------------------------------------------------------------------------------------------
通用接口

	上面的小节中，每次都用 echo ，没有一个统一的输出格式，
	如果需要在每条日志开头加上指定内容, 就需要修改脚本中每一处的日志，这就变成了一个体力活了

	针对这点, 可以定义一个输出函数, 所有的的输出统一调用这个函数, 现有测试脚本 t.sh 内容如下

#!/bin/bash 

function log() 
{
	echo "$@" 
} 

另外新建一个测试脚本 ta.sh
#!/bin/bash 
 
source ./t.sh 
 
log "this is a test..." 
log "today is `date '+%Y-%m-%d'` " 

执行 ./ta.sh 命令，结果如下
[root@VM-0-2-centos shell_log]# ./ta.sh  
this is a test... 
today is 2021-07-27 

如果现在想在每一行日志前面加上当前时间的话，直接修改 t.sh 中的 log 函数， t.sh调整后的脚本如下
#!/bin/bash 
 
function log() 
{ 
   echo "$(date '+%Y-%m-%d %H:%M:%S') $@" 
} 

然后再次执行 ./ta.sh 命令，结果如下
[root@VM-0-2-centos shell_log]# ./ta.sh  
2021-07-27 19:55:54 this is a test... 
2021-07-27 19:55:54 today is 2021-07-27 

上面只修改了 log 函数，ta.sh 中的每一行日志开头就都输出了当前的时间， 

$@ 表示传入log 函数的所有参数


打印开关
调试脚本的时候，会加上很多的日志打印，当调试完了之后，需要关闭所有的日志输出，
上面已经把日志打印统一到一个函数中了，
这时我们只需要禁止执行 log 函数的 echo 语句即可，修改之后的 t.sh 内容如下

#!/bin/bash 
 
function log() 
{ 
     [ 0 -gt 1 ]  && echo "$(date '+%Y-%m-%d %H:%M:%S') $@" 
} 


当 [ 0 -gt 1 ] 表示条件结果为 false 的时候，echo 语句就不会执行，这样就能关闭所有的日志打印

也可以在 t.sh 中加一个变量，表示是否开启日志，
		当开启的时候，才会有日志打印，
		开关关闭时，同时会关闭日志打印功能，调整后的 t.sh 内容如下
#!/bin/bash 
 
LOG_OPEN=0 
 
function log() 
{ 
     [ $LOG_OPEN -eq 1 ]  && echo "$(date '+%Y-%m-%d %H:%M:%S') $@" 
} 

需要开启日志的时候，把 LOG_OPEN 设置为1，关闭日志打印，设置为0即可


------------------------------------------------------------------------------------------------------------
日志等级

在不同的脚本逻辑中，打印的日志应该有不同的作用，有些是临时变量值的输出，
作为调试用的，有些是一些状态转换或者达到不同阶段的提示信息，还有些是严重的错误，需要重点输出并提醒用户

以上这些可以通过日志等级来实现，把日志划分等级，不同的等级屏幕上输出不同的颜色，便于查看，直接来看修改后的 t.sh 脚本内容吧

#!/bin/bash 
 
#日志级别 debug-1, info-2, warn-3, error-4, always-5 
LOG_LEVEL=3 
 
#调试日志 
function log_debug(){ 
  content="[DEBUG] $(date '+%Y-%m-%d %H:%M:%S') $@" 
  [ $LOG_LEVEL -le 1  ] && echo -e "\033[32m"  ${content}  "\033[0m" 
} 
#信息日志 
function log_info(){ 
  content="[INFO] $(date '+%Y-%m-%d %H:%M:%S') $@" 
  [ $LOG_LEVEL -le 2  ] && echo -e "\033[32m"  ${content} "\033[0m" 
} 
#警告日志 
function log_warn(){ 
  content="[WARN] $(date '+%Y-%m-%d %H:%M:%S') $@" 
  [ $LOG_LEVEL -le 3  ] && echo -e "\033[33m" ${content} "\033[0m" 
} 
#错误日志 
function log_err(){ 
  content="[ERROR] $(date '+%Y-%m-%d %H:%M:%S') $@" 
  [ $LOG_LEVEL -le 4  ] && echo -e "\033[31m" ${content} "\033[0m" 
} 
#一直都会打印的日志 
function log_always(){ 
   content="[ALWAYS] $(date '+%Y-%m-%d %H:%M:%S') $@" 
   [ $LOG_LEVEL -le 5  ] && echo -e  "\033[32m" ${content} "\033[0m" 
} 

把日志级别分成 5 个等级，分别是 : 
	debug日志、
	info日志、
	警告日志、
	错误日志、
	一直都打印的日志 ，

每个级别对应一个函数接口，而且每个级别可以定义不同的字符颜色，
方便在屏幕上查看错误以及警告，
上述脚本中错误日志是红色，警告日志是黄色，其他级别的日志是绿色

修改 ta.sh 脚本, 内容如下
#!/bin/bash 
 
source ./t.sh 
 
log_debug "this is debug log..." 
log_info "this is info log..." 
log_warn "this is warn log..." 
log_err "this is error log..." 
log_always "this is always log.." 

------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------------------------------------------


